{% extends 'admin/base.html' %}
{% block stage %}
<style type="text/css">
  .hide{
    display: none;
  }
</style>
<!-- main content starts here-->
<div  class="col-md-12">
  <h3>Left Tabs</h3>
  <hr/>
  <div class="col-md-3">
    <!-- required for floating -->
    <!-- Nav tabs -->
    <ul class="nav nav-tabs tabs-left">
      {% for country in countries %}
      <li {% if page.country.id == country.id %}class="active"{% endif %}><a href="#country_{{country.id}}" data-toggle="tab" class="country_tab">{{country.name}}</a></li>
      {% endfor %}
    </ul>
  </div>
  <div class="col-md-9">
    <form action="." method="POST" id="pageform">
    {% csrf_token %}
    <!-- Tab panes -->
    {{ pagecountry_formset.management_form }}
    {{ pagecountry_formset.non_form_errors }}
    {% for slug_form in pagecountry_formset %}
    <div class="tab-content">
      <div class="tab-pane {% if forloop.first %}active{% endif %}" id="country_{% if slug_form.instance.country.id %}{{ slug_form.instance.country.id }}{% else %}{{ slug_form.initial.country_id }}{% endif %}">
        <div class="panel panel-default">
          <div class="panel-heading">
            <h3 class="panel-title">Edit Page{{ slug_form.initial.country_id }}{{ slug_form.instance.country.name }}</h3>
          </div>

          <div class="panel-body">
              <div class="form-group">
                <label for="exampleInputEmail1">Title</label>
                {{ slug_form.title }}
                {{ slug_form.id }}
                {% if slug_form.title.errors %}
                    {% for error in slug_form.title.errors %}
                        <p class="failure">{{ error|escape }}</p>
                    {% endfor %}
                {% endif %}
              </div>
              <div class="form-group">
                <label for="exampleInputEmail1">Slug</label>
                {{ slug_form.slug }}
                {% if slug_form.slug.errors %}
                    {% for error in slug_form.slug.errors %}
                        <p class="failure">{{ error|escape }}</p>
                    {% endfor %}
                {% endif %}
              </div>
              <div class="form-group">
                <label for="exampleInputEmail1">Meta Title</label>
                {{ slug_form.meta_title }}
                {% if slug_form.meta_title.errors %}
                    {% for error in slug_form.meta_title.errors %}
                        <p class="failure">{{ error|escape }}</p>
                    {% endfor %}
                {% endif %}

              </div>
              <div class="form-group">
                <label for="exampleInputEmail1">Meta Description</label>
                {{ slug_form.meta_description }}
                {% if slug_form.meta_description.errors %}
                    {% for error in slug_form.meta_description.errors %}
                        <p class="failure">{{ error|escape }}</p>
                    {% endfor %}
                {% endif %}

              </div>
              <div class="form-group">
                <label for="exampleInputEmail1">Keywords</label>
                {{ slug_form.keywords }}
                {% if slug_form.keywords.errors %}
                    {% for error in slug_form.keywords.errors %}
                        <p class="failure">{{ error|escape }}</p>
                    {% endfor %}
                {% endif %}

              </div>
              <div class="form-group">
                {{ slug_form.category }}
                {% if slug_form.category.errors %}
                    {% for error in slug_form.category.errors %}
                        <p class="failure">{{ error|escape }}</p>
                    {% endfor %}
                {% endif %}
              <div class="form-group form_country" id="{% if slug_form.initial.country_id %}{{ slug_form.initial.country_id }}{% else %}{{ slug_form.instance.country.id }}{% endif %}">
                {{ slug_form.country }}
              </div>
                All Categories <input type="checkbox" name="all_categories" id="all_categories"/>
              </div>
              <div class="form-group">
                <label class="control-label" for="html">Page Content</label>
                <div class="control-group">
                  <div class="controls" id="form_content_{% if slug_form.initial.country_id %}{{ slug_form.initial.country_id }}{% else %}{{ slug_form.instance.country.id }}{% endif %}">
                    <span class="form_content" id="{% if slug_form.initial.country_id %}{{ slug_form.initial.country_id }}{% else %}{{ slug_form.instance.country.id }}{% endif %}">
                    {{ slug_form.content }}
                    </span>
                    {% if slug_form.content.errors %}
                        {% for error in slug_form.content.errors %}
                            <p class="failure">{{ error|escape }}</p>
                        {% endfor %}
                    {% endif %}

                  </div>
                </div>
              </div>
              <div class="draft-box">
                {{ slug_form.is_active }}Active
                {% if slug_form.is_active.errors %}
                    {% for error in slug_form.is_active.errors %}
                        <p class="failure">{{ error|escape }}</p>
                    {% endfor %}
                {% endif %}
              </div>
              <div class="draft-box">
                {{ slug_form.is_default }}Default
                {% if slug_form.is_default.errors %}
                    {% for error in slug_form.is_default.errors %}
                        <p class="failure">{{ error|escape }}</p>
                    {% endfor %}
                {% endif %}
              </div>
          </div>
        </div>
      </div>
    </div>
    {% endfor %}
    <div class="save-btn">
        <i class="fa fa-floppy-o"></i><input type="submit" value="Save"  class="save" id="save_button">
      </div>

    </form>
  </div>
  <div class="clearfix"></div>
</div>
<!-- main content ends here-->
{% load compress %}
{% compress js %}
<script type="text/javascript">
  CKEDITOR.config.allowedContent = true;

  $('.form_content').each(function(e){
    select_country = $(this).find('textarea')
    textarea_name = $(select_country).attr('name')
    country_id = $(this).attr('id')
    console.log(textarea_name)
    editor_name = 'editor_' + country_id
    CKEDITOR.replace(textarea_name)
  });
</script>
<script type="text/javascript">
  $ = jQuery;

  $(document).ready(function(e){
    $('.form_country').each(function(e){
      console.log($(this).find('select'))
      country_id = $(this).attr('id')
      select_country = $(this).find('select')
      $(select_country).find('option[value="'+country_id+'"]').attr("selected", "selected");
    });

  })
  $('#all_categories').click(function(e){
  $("#category option").select2('');
  if(document.getElementById('all_categories').checked) {
    $("#category option").attr("selected", "selected");

  }
  else{
    $("#category").select2("val", "");
  }
  $(".select2").select2({ width: '100%' })
  });

  $('.country_tab').click(function(e){
    country_name = $(this).text()
    $('.tab-pane').removeClass('active')
    $('#country_'+country_name).addClass('active')
  });
$('#save_button').click(function(e){
  $('pageform').submit();
});
</script>
{% endcompress %}
{% endblock %}